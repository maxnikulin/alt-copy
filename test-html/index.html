<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Alt Copy Test Page</title>
    <link rel="stylesheet" href="alt-copy-test.css" type="text/css">
  </head>
  <body>
    <h1>Alt Copy Test Page</h1>
    <form id="formInterceptor">
      <ul>
        <li><label><input type="checkbox" id="interceptCopy">
            Enable copy event interceptor</label></li>
        <li><label><input type="checkbox" id="checkboxLog" checked>
            Log copy event to console</li>
        <li><label><input type="checkbox" id="checkboxOverwrite" checked>
            Overwrite data</li>
        <li><label><input type="checkbox" id="checkboxAlert">
            Alert popup</li>
        <li><label><input type="checkbox" id="checkboxStop">
            Stop propagation</li>
      </ul>
    </form>
    <div>
      <textarea placeholder="You can pase copied text here"></textarea>
    </div>
    <ul>
      <li>Text with title: It happened
        <span title="2021-10-15 18:50:03">2 hours ago</span>. </li>
      <li><code>&lt;time&gt;</code> element: <time datetime=2021-10-23>1 day ago</time>.</li>
      <li><code>&lt;data&gt;</code> element: <data value="12345">Textual representation</data>.</li>
      <li>Meter <meter min="0" max="100" value="75" low="33" high="66" optimum="50">75</meter></li>
      <li>Progress <progress max="100" value="75">75/100</progress></li>
      <li>Selection <span class="disabled-selection">is disabled</span>.</li>
      <li>Control characters
        <span title="echo&#x08;&#x08;ls &#x09;&#x09;&#x0a;echo world">in the title attribute.</span></li>
      <li>Image: <img alt="Broken image alt text"></li>
    </ul>
    <h2 id="time-extensions"><code>&lt;time&gt;</code> element extensions</h2>
    <p>See <a
      title="project repository at GitHub"
      href="https://github.com/github/time-elements">https://github.com/github/time-elements</a></p>
    <ul>
      <li><code>&lt;relative-time datetime="2014-04-01T16:30:00-08:00"&gt;</code>:
        <relative-time datetime="2014-04-01T16:30:00-08:00">April 1, 2014</relative-time>.</li>
      <li><code>&lt;time-until datetime="2024-05-02T16:30:00-08:00"&gt;</code>:
        <time-until datetime="2024-05-02T16:30:00-08:00">May 2, 2024</time-until>.</li>
      <li><code>&lt;time-ago datetime="2012-06-03T16:30:00-08:00" format="micro"&gt;</code>:
        <time-ago datetime="2012-06-03T16:30:00-08:00" format="micro">June 3, 2012</time-ago>.</li>
      <li><code>&lt;local-time datetime="2015-07-04T16:30:00-08:00"&gt;</code>:
        <local-time datetime="2015-07-04T16:30:00-08:00">July 4, 2015 4:30PM PDT</local-time>.</li>
    </ul>
    <h2 id="wrapper">Text attribute of a wrapping element</h2>
    <ul>
      <li>A link with no title inside a <code>&lt;span&gt;</code>
        with <span class="nested" title="Title of span"><a href="#">title</a></span>.</li>
      <li>A link with no title inside a <code>&lt;span&gt;</code>
        with <span class="nested" title="Title of span with spaces">
          <a href="#">title</a>	</span>,
        some spaces around <code>&lt;a&gt;</code>.</li>
      <li>Span with title around a link contains
        <span class="nested" title="Title of span with other text">some more
          <a href="#">text</a></span>.</li>
    </ul>
    <h2 id="form">Form input elements</h2>
    <form>
      <ul>
        <li><label>Disabled input <input disabled value="Disabled Text"></label>
        <li><label>Read-only input <input readonly value="Read-only Text"></label>
        <li><label>Disabled with title
            <input disabled title="Title of disable input" value="Disabled Text with title">
          </label></li>
        <li><label>Input with placeholder <input placeholder="Default text">
          </label></li>
        <li><label>Password <input type="password" value="qwerty"></label></li>
        <li><label>Select
            <select>
              <option value="1st">First</option>
              <option value="2nd">Second</option>
              <optgroup label="Second Half">
                <option value="3rd">Third</option>
                <option value="4rth">Fourth</option>
              </optgroup>
            </select>
          </label></li>
        <li><label>Select multiple
            <select multiple>
              <optgroup label="First group">
                <option>One</option>
                <option>Two</option>
                <option>Three</option>
              </optgroup>
              <option>Four</option>
              <optgroup label="Second group">
                <option>Five</option>
                <option>Six</option>
                <option>Seven</option>
              </optgroup>
            </select>
          </label></li>
        <li>Date <input type="date" value="2021-10-20" max="2021-12-31"></li>
        <li>Date and time <input type="datetime-local" min="2010-01-01" value="2021-10-11T12:13:14"></li>
        <li>Input <code>type="button"</code> <input type="button" value="input button">
          <input type="submit"></li>
        <li>Button element <button>Text of button element</button></li>
        <li>Color <input type="color"></li>
        <li>File <input type="file"></li>
        <li>Range input <input type="range" min="-10" max="38"></li>
        <li>Image input <input type="image" alt="Alt Image" src="../icons/alt-copy-16.png"></li>
      </ul>
    </form>
    <h2>Input fields with handlers</h2>
        <ul>
          <li><input type="text" id="inputWithCopyListener">
            With copy event listener.</li>
          <li><input type="text" id="inputWithBlurListener">
            With blur event listener.</li>
        </ul>
    <h2 id="frame">Frame</h2>
    <iframe id="nestedFrame"></iframe>
    <script>
      var formInterceptor = document.getElementById("formInterceptor");
      function acpTestMakeOnCopyListener(name) {
        // a trick to set `displayName` for debugger
        const funcName = "acpTestOnCopy_" + name;
        return {
          [funcName]: function (evt) {
            try {
              if (formInterceptor.checkboxLog.checked) {
                console.log("%o %o %o", name, evt.type, evt.target);
              }
              if (formInterceptor.checkboxStop.checked) {
                evt.stopImmediatePropagation();
                evt.preventDefault();
              }
              if (formInterceptor.checkboxOverwrite.checked) {
                evt.clipboardData.clearData();
                evt.clipboardData.setData("text/plain", `Overwritten by ${name}`);
                evt.clipboardData.setData("text/html", `Overwritten by <strong>${name}</strong>`);
              }
              if (formInterceptor.checkboxAlert.checked) {
                alert(`Copy event handler: ${name}`);
              }
            } catch (ex) {
              console.error("acpTestOnCopy: %o", ex);
            }
          },
        }[funcName];
      }

      var interceptCheckbox = document.getElementById("interceptCopy");
      var listeners = [];
      const eventName = "copy";
      function acpTestEnableListeners() {
        function acpTestAddListener(target, name, capture) {
          const listener = acpTestMakeOnCopyListener(name);
          const options = { capture };
          target.addEventListener(eventName, listener, options);
          listeners.push([target, listener, options]);
        }

        acpTestAddListener(document, "docCapture", true);
        acpTestAddListener(document, "docNoCaptr", false);
        acpTestAddListener(window, "winCapture", true);
        acpTestAddListener(window, "winNoCaptr", false);
        console.log("acpTest: copy interceptor is installed");
      }
      interceptCheckbox.addEventListener("change",
      function acpTestCopyInterceptor(evt) {
        evt.preventDefault();
        evt.stopImmediatePropagation();
        const target = evt.target;
        if (target.checked) {
          acpTestEnableListeners();
        } else {
          for (const [ target, listener, options ] of listeners) {
            target.removeEventListener(eventName, listener, options);
          }
          console.log("acpTest: copy interceptor is removed");
        }
      }, false);
      if (interceptCheckbox.checked) {
        // In Firefox checkbox state is persistent across reloads.
        acpTestEnableListeners();
      }
      var nestedFrame = document.getElementById("nestedFrame");
      if (!window.location.search) {
        nestedFrame.src = window.location.href + "?noframe=1";
        nestedFrame.height = document.documentElement.clientHeight + 10;
      } else {
        nestedFrame.height = 2;
      }

      var inputWithBlurListener = document.getElementById("inputWithBlurListener");
      inputWithBlurListener.addEventListener("blur", function acpTestBlurListener(evt) {
        const { target } = evt;
        const { length } = target.value.split(/\s+/);
        target.value = `${length} ${target.value} ${length}`;
      });

      var inputWithCopyListener = document.getElementById("inputWithCopyListener");
      inputWithCopyListener.addEventListener(
        "copy", acpTestMakeOnCopyListener("elmCapture"), { capture: true });
      inputWithCopyListener.addEventListener(
        "copy", acpTestMakeOnCopyListener("elmNoCaptr"), { capture: false });
    </script>
  </body>
</html>
